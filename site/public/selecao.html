<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="css/cards.css" />
    <link
      rel="shortcut icon"
      type="image/jpg"
      href="assets/icon/simboloBranco.png"
    />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="./js/funcoes.js"></script>


    <title>Cards</title>
  </head>
  <body>
    <main>
      <header>
        <div>
          <img src="assets/imgs/userIcon.svg" alt="" id="avatar" />
          <p><button id="openModalButton">Escolha seu avatar</button></p>
          <h5 id="nickUsuario">NickName do Usuário</h5>
        </div>
        <a href="./index.html">
          <i>Deslogar</i>
          <img src="assets/imgs/logOut.svg" alt="" />
        </a>
      </header>
      <article id="interacao">
        <section id="cardInputs">
          <form action="">
            <select
              name="cardImg"
              id="cardImg"
              onchange="trocarCard()"
              required
            >
              <option value="" disabled selected>
                Escolha a moldura da carta.
              </option>
              <option value="lendaria" id="cardLendaria">Lendaria</option>
              <option value="epica" id="cardEpica">Épica</option>
              <option value="rara" id="cardRara">Rara</option>
              <option value="dourada" id="cardDourada">Dourada</option>
            </select>
            <select
              name="jogadorImg"
              id="jogadorImg"
              onchange="trocarJogador()"
              required
            >
              <option value="" disabled selected>Escolha o jogador</option>
              <option style="display: block" value="cassio" id="cassio">
                Cássio
              </option>
              <option style="display: block" value="dida" id="dida">
                Dida
              </option>
              <option
                style="display: block"
                value="ronaldoGiovanelli"
                id="ronaldoG"
              >
                Ronaldo Giovanelli
              </option>

              <option style="display: block" value="gil" id="gil">Gil</option>
              <option style="display: block" value="gamarra" id="gamarra">
                Gamarra
              </option>
              <option style="display: block" value="chicao" id="chicao">
                Chicão
              </option>
              <option
                style="display: block"
                value="domingosDaGuia"
                id="domingosDaGuia"
              >
                Domingos da Guia
              </option>

              <option style="display: block" value="zeMaria" id="zeMaria">
                Zé Maria
              </option>
              <option style="display: block" value="fagner" id="fagner">
                Fagner
              </option>
              <option style="display: block" value="alessandro" id="alessandro">
                Alessandro
              </option>

              <option style="display: block" value="wladimir" id="wladimir">
                Wladimir
              </option>
              <option
                style="display: block"
                value="robertoCarlos"
                id="robertoCarlos"
              >
                Roberto Carlos
              </option>
              <option
                style="display: block"
                value="fabioSantos"
                id="fabioSantos"
              >
                Fábio Santos
              </option>

              <option style="display: block" value="marcelinho" id="marcelinho">
                Marcelinho Carioca
              </option>
              <option style="display: block" value="rivelino" id="rivelino">
                Rivelino
              </option>
              <option style="display: block" value="ralf" id="ralf">
                Ralf
              </option>
              <option style="display: block" value="socrates" id="socrates">
                Sócrates
              </option>
              <option style="display: block" value="paulinho" id="paulinho">
                Paulinho
              </option>
              <option style="display: block" value="neto" id="neto">
                Neto
              </option>
              <option
                style="display: block"
                value="renatoAugusto"
                id="renatoAugusto"
              >
                Renato Augsto
              </option>

              <option style="display: block" value="emersonSheik" id="sheik">
                Emerson Sheik
              </option>
              <option style="display: block" value="baltazar" id="baltazar">
                Baltazar
              </option>
              <option style="display: block" value="claudio" id="claudio">
                Cláudio
              </option>
              <option style="display: block" value="ronaldo" id="ronaldo">
                Ronaldo
              </option>
              <option style="display: block" value="casagrande" id="casagrande">
                Casagrande
              </option>
              <option style="display: block" value="guerrero" id="guerrero">
                Guerrero
              </option>
              <option
                style="display: block"
                value="rogerGuedes"
                id="rogerGuedes"
              >
                Roger Guedes
              </option>
            </select>
            <input
              type="text"
              placeholder="Digite a pontuação de ataque"
              id="overAllAtaque_input"
            />
            <input
              type="text"
              placeholder="Digite a pontuação de defesa"
              id="overAllDefesa_input"
            />
            <input
              type="text"
              placeholder="Digite a pontuação de passe"
              id="overAllPasse_input"
            />
            <div id="btnsCard">
              <button onclick="montarJogador(event)">Montar Jogador</button>
              <button onclick="resetarJogador()">Resetar Jogadores</button>
            </div>
          </form>
        </section>
        <section id="sessaoCard">
          <div id="areaCard" style="width: auto; height: 80vh" class="myDiv">
            <div id="jogador">
              <img src="assets/jogadores/cassio.svg" alt="" />
            </div>
            <div id="skills">
              <p>Ataque: <span id="statsAtq">?</span> </p>
              <p>Defesa: <span id="statsDef">?</span></p>
              <div>
                <p>Passe: <span id="statsPass">?</span></p>
                <p>OverAll: <span id="statsTotal">?</span></p>
              </div>
            </div>
          </div>
          <div id="btnCompartilhar">
            <button onclick="captureDiv()">Salvar imagem</button>
          </div>
        </section>
      </article>
      <article id="analitics">
        <div id="tabela">
          <h1>Ranking de Jogadores</h1>
          <table>
            <tr>
              <th class="rank">Posição</th>
              <th>Jogador</th>
              <th>Número de escolhas</th>
            </tr>
            <tr>
              <td class="rank"><u>1°</u></td>
              <td id="primeiro">Cássio</td>
              <td id="primeiroQtd">0</td>
            </tr>
            <tr>
              <td class="rank rank2">2°</td>
              <td class="rank rank2" id="segundo">Sócrates</td>
              <td class="rank rank2" id="segundoQtd">0</td>
            </tr>
            <tr>
              <td class="rank">3°</td>
              <td id="terceiro">Renato Augusto</td>
              <td id="terceiroQtd">0</td>
            </tr>
          </table>
        </div>

      </article>
      <div id="avatarModal" class="modal" style="display: none">
        <div class="modal-content">
          <div><img src="assets/imgs/cascao.png" alt="" /></div>
          <div><img src="assets/imgs/mantuan.png" alt="" /></div>
          <div><img src="assets/imgs/anne.png" alt="" /></div>
          <div><img src="assets/imgs/cassioMeme.png" alt="" /></div>
          <div><img src="assets/imgs/homer.png" alt="" /></div>
          <div><img src="assets/imgs/cj.png" alt="" /></div>
        </div>
      </div>

      <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
      <!-- <script src="script.js"></script> -->

      <footer>
        <article>
        <div class="logo" >
          <a href="#HOME">
          <img src="assets/icon/simboloBranco.png" alt="">
        </a>
        </div>
        <p>De torcedor para Torcedor</p>
        <div id="contato">
          <a href="https://www.linkedin.com/in/gustavo-gomes-da-silva/" target="_blank">
            <img src="assets/imgs/linkedinLogo.svg" alt="">
          </a>
          <a href="https://github.com/GustavoGomesDaSilva" target="_blank">
            <img src="assets/imgs/githubLogo.svg" alt="">
          </a>
        </div>
        <p>Copyrigth © 2023 Corinthians. Todos os direitos reservados</p>
      </article>
      </footer>
    </main>
  </body>
</html>
<script>

  var nick = document.getElementById("nickUsuario");

  nick.innerHTML = sessionStorage.NICK_USUARIO;

  function captureDiv() {
    // Captura a div desejada pela classe
    var divs = document.getElementsByClassName("myDiv");
    var div = divs[0]; // Supondo que haja apenas um elemento com a classe 'myDiv'

    // Verifica se o elemento foi encontrado
    if (!div) {
      console.log("Elemento não encontrado!");
      return;
    }

    // Captura a div como uma imagem
    html2canvas(div).then(function (canvas) {
      // Cria um elemento de imagem
      var img = new Image();
      img.src = canvas.toDataURL();

      // Exibe a imagem na página
      // document.body.appendChild(img);

      // Ou salva a imagem como arquivo
      var link = document.createElement("a");
      link.href = canvas.toDataURL();
      link.download = "screenshot.png";
      link.click();
    });
  }

  function trocarCard() {
    var selectElement = document.getElementById("cardImg");
    var selectedValue = selectElement.value;

    var divElement = document.getElementById("areaCard");

    if (selectedValue === "lendaria") {
      divElement.style.backgroundImage = "url('assets/imgs/lendaria.png')";
    } else if (selectedValue === "epica") {
      divElement.style.backgroundImage = "url('assets/imgs/epica.png')";
    } else if (selectedValue === "rara") {
      divElement.style.backgroundImage = "url('assets/imgs/rara.png')";
    } else if (selectedValue === "dourada") {
      divElement.style.backgroundImage = "url('assets/imgs/dourada.png')";
    }
  }

  function trocarJogador() {
    var selectElement = document.getElementById("jogadorImg");
    var selectedJogador = selectElement.value;

    var divJogador = document.getElementById("jogador");

    if (selectedJogador === "cassio") {
      divJogador.innerHTML = "<img src='assets/jogadores/cassio.svg' alt=''>";

      var cassioEscolha = document.getElementById("cassio");
      cassioEscolha.style.display = "none";
    } else if (selectedJogador === "dida") {
      divJogador.innerHTML = "<img src='assets/jogadores/dida.svg' alt=''>";
    } else if (selectedJogador === "ronaldoGiovanelli") {
      divJogador.innerHTML =
        "<img src='assets/jogadores/ronaldoGiovanelli.svg' alt=''>";
    }
    // fim dos goleiros, começo dos defensores
    else if (selectedJogador === "gil") {
      divJogador.innerHTML = "<img src='assets/jogadores/gil.svg' alt=''>";
    } else if (selectedJogador === "gamarra") {
      divJogador.innerHTML = "<img src='assets/jogadores/gamarra.svg' alt=''>";
    } else if (selectedJogador === "domingosDaGuia") {
      divJogador.innerHTML =
        "<img src='assets/jogadores/domingosDaGuia.svg' alt=''>";
    } else if (selectedJogador === "chicao") {
      divJogador.innerHTML = "<img src='assets/jogadores/chicao.svg' alt=''>";
    }

    // fim dos defensores, começo dos laterais
    else if (selectedJogador === "zeMaria") {
      divJogador.innerHTML = "<img src='assets/jogadores/zeMaria.svg' alt=''>";
    } else if (selectedJogador === "fagner") {
      divJogador.innerHTML = "<img src='assets/jogadores/fagner.svg' alt=''>";
    } else if (selectedJogador === "alessandro") {
      divJogador.innerHTML =
        "<img src='assets/jogadores/alessandro.svg' alt=''>";
    } else if (selectedJogador === "wladimir") {
      divJogador.innerHTML = "<img src='assets/jogadores/wladimir.svg' alt=''>";
    } else if (selectedJogador === "robertoCarlos") {
      divJogador.innerHTML =
        "<img src='assets/jogadores/robertoCarlos.svg' alt=''>";
    } else if (selectedJogador === "fabioSantos") {
      divJogador.innerHTML =
        "<img src='assets/jogadores/fabioSantos.svg' alt=''>";
    }

    // fim dos laterais, começo dos meias
    else if (selectedJogador === "marcelinho") {
      divJogador.innerHTML =
        "<img src='assets/jogadores/marcelinho.svg' alt=''>";
    } else if (selectedJogador === "rivelino") {
      divJogador.innerHTML = "<img src='assets/jogadores/rivelino.svg' alt=''>";
    } else if (selectedJogador === "ralf") {
      divJogador.innerHTML = "<img src='assets/jogadores/ralf.svg' alt=''>";
    } else if (selectedJogador === "socrates") {
      divJogador.innerHTML = "<img src='assets/jogadores/socrates.svg' alt=''>";
    } else if (selectedJogador === "paulinho") {
      divJogador.innerHTML = "<img src='assets/jogadores/paulinho.svg' alt=''>";
    } else if (selectedJogador === "neto") {
      divJogador.innerHTML = "<img src='assets/jogadores/neto.svg' alt=''>";
    } else if (selectedJogador === "renatoAugusto") {
      divJogador.innerHTML =
        "<img src='assets/jogadores/renatoAugusto.svg' alt=''>";
    }

    // fim dos meias, começo dos atacantes
    else if (selectedJogador === "emersonSheik") {
      divJogador.innerHTML =
        "<img src='assets/jogadores/emersonSheik.svg' alt=''>";
    } else if (selectedJogador === "baltazar") {
      divJogador.innerHTML = "<img src='assets/jogadores/baltazar.svg' alt=''>";
    } else if (selectedJogador === "claudio") {
      divJogador.innerHTML = "<img src='assets/jogadores/claudio.svg' alt=''>";
    } else if (selectedJogador === "ronaldo") {
      divJogador.innerHTML = "<img src='assets/jogadores/ronaldo.svg' alt=''>";
    } else if (selectedJogador === "casagrande") {
      divJogador.innerHTML =
        "<img src='assets/jogadores/casagrande.svg' alt=''>";
    } else if (selectedJogador === "guerrero") {
      divJogador.innerHTML = "<img src='assets/jogadores/guerrero.svg' alt=''>";
    } else if (selectedJogador === "rogerGuedes") {
      divJogador.innerHTML =
        "<img src='assets/jogadores/rogerGuedes.svg' alt=''>";
    }
  }

  // avatar

  // Referências aos elementos do DOM

  const openModalButton = document.getElementById("openModalButton");
  const modal = document.getElementById("avatarModal");

  // Evento de clique para abrir o modal
  openModalButton.addEventListener("click", function () {
    modal.style.display = "block";
  });

  // Evento de clique fora do modal para fechá-lo
  window.addEventListener("click", function (event) {
    if (event.target == modal) {
      modal.style.display = "none";
    }
  });

  const userIconImage = document.querySelector("header img");

  // Referências às imagens dentro do modal
  const modalImages = document.querySelectorAll(".modal-content img");

  // Função para trocar a imagem do userIcon.svg
  function trocarImagem(e) {
    const selectedImageSrc = e.target.getAttribute("src");
    userIconImage.setAttribute("src", selectedImageSrc);
    modal.style.display = "none";
  }

  // Adicionando o evento de clique às imagens no modal
  modalImages.forEach(function (image) {
    image.addEventListener("click", trocarImagem);
  });
</script>
<!-- banco -->
<script>

var optionsBackup = [];

  function montarJogador(event) {
    event.preventDefault(); // Impede o comportamento padrão do botão

    var selectElement = document.getElementById("jogadorImg");
    var selectedValue = selectElement.value;

    // Encontrar a opção selecionada pelo valor
    var selectedOption = selectElement.querySelector(
      "option[value='" + selectedValue + "']"
    );
        // Remove a opção selecionada da combo box
    if (selectedOption) {
    // Adicionar a opção à lista de backup
    optionsBackup.push(selectedOption);

    // Remover a opção do select
    selectElement.removeChild(selectedOption);
  }

    var nomeVar = selectedValue;
    // alert(nomeVar)
    var overAllAtaqueVar = Number(overAllAtaque_input.value);
    var overAllDefesaVar = Number(overAllDefesa_input.value);
    var overAllPasseVar = Number(overAllPasse_input.value);

    var atqDiv = document.getElementById("statsAtq");
    var defDiv = document.getElementById("statsDef");
    var passDiv = document.getElementById("statsPass");
    var totDiv = document.getElementById("statsTotal");

    var overAllTotal = ((overAllAtaqueVar + overAllDefesaVar + overAllPasseVar) / 3).toFixed(2);

    atqDiv.innerHTML = overAllAtaqueVar;
    defDiv.innerHTML = overAllDefesaVar;
    passDiv.innerHTML = overAllPasseVar;
    totDiv.innerHTML = overAllTotal;

    if (
      nomeVar == null ||
      overAllAtaqueVar == null ||
      overAllDefesaVar == null ||
      overAllPasseVar == null

    ) {
      alert("Preencha todos os campos");
    } else {
      // alert("sgjkasdjgsklgjsdadAAAAAAAA")

      fetch("/usuarios/montarJogador", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                // crie um atributo que recebe o valor recuperado aqui
                // Agora vá para o arquivo routes/usuario.js
                nomeServer: nomeVar,
                overAllAtaqueServer: overAllAtaqueVar,
                overAllDefesaServer: overAllDefesaVar,
                overAllPasseServer: overAllPasseVar,
            })
        })
        .then(function (resposta) {
          console.log("resposta: ", resposta);
          console.log("testee");

          if (resposta.ok) {
            window.alert(
              "Estatisticas enviadas para o banco de dados"
            );
            
          } else if (resposta.status == 404) {
            window.alert("Deu 404!");
          } else {
            throw (
              "Houve um erro ao tentar realizar a postagem! Código da resposta: " +
              resposta.status
            );
          }
        })
        .catch(function (resposta) {
          console.log(`#ERRO: ${resposta}`);
          // finalizarAguardar();
        });

      return false;
    }
  }

  function resetarJogadores() {
  var selectElement = document.getElementById("jogadorImg");

  // Remover todas as opções atuais
  selectElement.innerHTML = "";

  // Recriar as opções a partir do backup
  optionsBackup.forEach(function (option) {
    selectElement.appendChild(option);
  });

  // Limpar a lista de backup
  optionsBackup = [];
}
</script>
<script>
  
  function tabela(){

    fetch("/usuarios/listar", {
          method: "GET",
          headers: {
            "Content-Type": "application/json",
          },
         
        })
          .then(function (resposta) {
            console.log("ESTOU NO THEN DO listar()!");

            if (resposta.ok) {
              console.log(resposta);

              resposta.json().then(function (json) {
                console.log(json);
                console.log(JSON.stringify(json));

                ranking(json)            

                
              });
            } else {
              console.log("Houve um erro ao tentar trazer os dados para a tabe");

              resposta.text().then(function (texto) {
                console.error(texto);
              });
            }
          })
          .catch(function (erro) {
            console.log(erro);
          });
  

 
  }
  function ranking(posicoes){
      var rankingPrimeiroNome = document.getElementById("primeiro")
      var rankingPrimeiroQtd = document.getElementById("primeiroQtd")

      var rankingSegundoNome = document.getElementById("segundo")
      var rankingSegundoQtd = document.getElementById("segundoQtd")

      var rankingTerceiroNome = document.getElementById("terceiro")
      var rankingTerceiroQtd = document.getElementById("terceiroQtd")

      // alert(posicoes[0])

      // console.log(nomePrimeiro, qtdPrimeiro)
    
      for(var i = 0; i<3; i++){
        var nomeJogador = posicoes[i].nome
        var qtdJogador = posicoes[i].repeticoes

        if(i==0){
          rankingPrimeiroNome.innerHTML = nomeJogador
          rankingPrimeiroQtd.innerHTML = qtdJogador
        }else if(i==1){
          rankingSegundoNome.innerHTML = nomeJogador
          rankingSegundoQtd.innerHTML = qtdJogador
        }else{
          rankingTerceiroNome.innerHTML = nomeJogador
          rankingTerceiroQtd.innerHTML = qtdJogador
        }
      } 
    }
    tabela()
</script>